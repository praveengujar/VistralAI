<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VistralAI - Auth Flow</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: "Inter", -apple-system, BlinkMacSystemFont, sans-serif; }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState } = React;



const Component = () => {
  const [activeFlow, setActiveFlow] = useState('credentials');

  const flows = [
    { id: 'credentials', name: 'Credentials Login', color: '#3B82F6' },
    { id: 'oauth', name: 'OAuth Login', color: '#F59E0B' },
    { id: 'session', name: 'Session Validation', color: '#22C55E' }
  ];

  const participants = [
    { id: 'user', name: 'User', icon: 'ðŸ‘¤', color: '#8B5CF6' },
    { id: 'browser', name: 'Browser', icon: 'ðŸŒ', color: '#3B82F6' },
    { id: 'nextjs', name: 'Next.js App', icon: 'â–²', color: '#000' },
    { id: 'nextauth', name: 'NextAuth.js', icon: 'ðŸ”', color: '#10B981' },
    { id: 'db', name: 'MongoDB', icon: 'ðŸƒ', color: '#22C55E' },
    { id: 'audit', name: 'Audit Log', icon: 'ðŸ“‹', color: '#64748B' }
  ];

  const credentialsSteps = [
    { from: 0, to: 1, label: 'Enter email/password', type: 'action' },
    { from: 1, to: 2, label: 'POST /api/auth/signin', type: 'request' },
    { from: 2, to: 3, label: 'Validate credentials', type: 'internal' },
    { from: 3, to: 4, label: 'getUserByEmail()', type: 'query' },
    { from: 4, to: 3, label: 'User record', type: 'response' },
    { from: 3, to: 3, label: 'verifyPassword()', type: 'internal' },
    { from: 3, to: 3, label: 'Generate JWT token', type: 'success' },
    { from: 3, to: 4, label: 'Update lastLoginAt', type: 'query' },
    { from: 3, to: 5, label: 'Log signin event', type: 'query' },
    { from: 3, to: 1, label: 'Set HTTP-only cookie', type: 'response' },
    { from: 1, to: 0, label: 'Redirect to /dashboard', type: 'success' }
  ];

  const oauthSteps = [
    { from: 0, to: 1, label: 'Click OAuth provider', type: 'action' },
    { from: 1, to: 3, label: 'GET /api/auth/signin/google', type: 'request' },
    { from: 3, to: 1, label: 'Redirect to OAuth provider', type: 'redirect' },
    { from: 1, to: 0, label: 'OAuth consent screen', type: 'action' },
    { from: 0, to: 1, label: 'Grant permission', type: 'action' },
    { from: 1, to: 3, label: 'OAuth callback with code', type: 'request' },
    { from: 3, to: 3, label: 'Exchange code for tokens', type: 'internal' },
    { from: 3, to: 4, label: 'Find or create user', type: 'query' },
    { from: 3, to: 4, label: 'Link OAuth account', type: 'query' },
    { from: 3, to: 5, label: 'Log signin event', type: 'query' },
    { from: 3, to: 1, label: 'Set HTTP-only cookie', type: 'response' },
    { from: 1, to: 0, label: 'Redirect to /dashboard', type: 'success' }
  ];

  const sessionSteps = [
    { from: 0, to: 1, label: 'Access protected route', type: 'action' },
    { from: 1, to: 2, label: 'Request with cookie', type: 'request' },
    { from: 2, to: 3, label: 'Validate JWT token', type: 'internal' },
    { from: 3, to: 2, label: 'Session data âœ“', type: 'success', condition: 'valid' },
    { from: 2, to: 1, label: 'Protected content', type: 'response', condition: 'valid' },
    { from: 3, to: 2, label: 'null session âœ—', type: 'error', condition: 'invalid' },
    { from: 2, to: 1, label: 'Redirect to /auth/login', type: 'redirect', condition: 'invalid' }
  ];

  const getSteps = () => {
    switch (activeFlow) {
      case 'credentials': return credentialsSteps;
      case 'oauth': return oauthSteps;
      case 'session': return sessionSteps;
      default: return credentialsSteps;
    }
  };

  const getStepColor = (type) => {
    switch (type) {
      case 'action': return '#8B5CF6';
      case 'request': return '#3B82F6';
      case 'response': return '#06B6D4';
      case 'query': return '#22C55E';
      case 'internal': return '#F59E0B';
      case 'success': return '#10B981';
      case 'error': return '#EF4444';
      case 'redirect': return '#EC4899';
      default: return '#64748B';
    }
  };

  return (
    <div style={{ minHeight: '100vh', background: 'linear-gradient(180deg, #0C0F1A 0%, #131825 50%, #0C0F1A 100%)', padding: '24px 16px', fontFamily: "'Inter', -apple-system, BlinkMacSystemFont, sans-serif" }}>
      <div style={{ textAlign: 'center', marginBottom: '20px' }}>
        <h1 style={{ fontSize: '24px', fontWeight: '700', color: '#F8FAFC', margin: '0 0 6px 0' }}>VistralAI Authentication Flows</h1>
        <p style={{ fontSize: '12px', color: '#64748B', margin: '0 0 16px 0' }}>NextAuth.js with Credentials and OAuth providers</p>
        
        {/* Flow Selector */}
        <div style={{ display: 'flex', justifyContent: 'center', gap: '8px' }}>
          {flows.map((flow) => (
            <button key={flow.id} onClick={() => setActiveFlow(flow.id)} style={{ background: activeFlow === flow.id ? `${flow.color}20` : '#1A1F2E', border: `2px solid ${activeFlow === flow.id ? flow.color : '#334155'}`, borderRadius: '8px', padding: '8px 16px', cursor: 'pointer', transition: 'all 0.2s' }}>
              <span style={{ color: activeFlow === flow.id ? flow.color : '#94A3B8', fontSize: '11px', fontWeight: '600' }}>{flow.name}</span>
            </button>
          ))}
        </div>
      </div>

      <div style={{ maxWidth: '1200px', margin: '0 auto' }}>
        {/* Participants Header */}
        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(6, 1fr)', gap: '8px', marginBottom: '20px' }}>
          {participants.map((p) => (
            <div key={p.id} style={{ background: '#1A1F2E', borderRadius: '8px', padding: '12px', textAlign: 'center', border: `1px solid ${p.color}40` }}>
              <div style={{ fontSize: '24px', marginBottom: '4px' }}>{p.icon}</div>
              <div style={{ color: p.color, fontSize: '10px', fontWeight: '600' }}>{p.name}</div>
            </div>
          ))}
        </div>

        {/* Flow Visualization */}
        <div style={{ background: `${flows.find(f => f.id === activeFlow)?.color}08`, borderRadius: '12px', border: `2px solid ${flows.find(f => f.id === activeFlow)?.color}30`, padding: '20px' }}>
          <div style={{ color: flows.find(f => f.id === activeFlow)?.color, fontSize: '12px', fontWeight: '700', marginBottom: '16px', textAlign: 'center' }}>
            {flows.find(f => f.id === activeFlow)?.name} Flow
          </div>

          {/* Steps */}
          <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
            {getSteps().map((step, idx) => (
              <div key={idx} style={{ display: 'flex', alignItems: 'center', gap: '12px', padding: '8px', background: step.condition === 'invalid' ? '#EF444410' : step.condition === 'valid' ? '#22C55E10' : '#0F172A', borderRadius: '8px', border: `1px solid ${getStepColor(step.type)}30` }}>
                <div style={{ width: '24px', height: '24px', background: getStepColor(step.type), borderRadius: '50%', display: 'flex', alignItems: 'center', justifyContent: 'center', color: 'white', fontSize: '10px', fontWeight: '700' }}>{idx + 1}</div>
                <div style={{ display: 'flex', alignItems: 'center', gap: '8px', flex: 1 }}>
                  <div style={{ background: participants[step.from].color, borderRadius: '4px', padding: '2px 8px' }}>
                    <span style={{ color: 'white', fontSize: '9px', fontWeight: '600' }}>{participants[step.from].name}</span>
                  </div>
                  <svg width="24" height="12" viewBox="0 0 24 12">
                    <line x1="0" y1="6" x2="18" y2="6" stroke={getStepColor(step.type)} strokeWidth="2" />
                    <polygon points="18,2 24,6 18,10" fill={getStepColor(step.type)} />
                  </svg>
                  <div style={{ background: participants[step.to].color, borderRadius: '4px', padding: '2px 8px' }}>
                    <span style={{ color: 'white', fontSize: '9px', fontWeight: '600' }}>{participants[step.to].name}</span>
                  </div>
                </div>
                <div style={{ background: `${getStepColor(step.type)}20`, borderRadius: '4px', padding: '4px 10px', borderLeft: `3px solid ${getStepColor(step.type)}` }}>
                  <span style={{ color: getStepColor(step.type), fontSize: '10px', fontWeight: '500' }}>{step.label}</span>
                </div>
                {step.condition && (
                  <span style={{ color: step.condition === 'valid' ? '#22C55E' : '#EF4444', fontSize: '9px', fontWeight: '600' }}>
                    [{step.condition === 'valid' ? 'Token Valid' : 'Token Invalid'}]
                  </span>
                )}
              </div>
            ))}
          </div>
        </div>

        {/* Legend */}
        <div style={{ marginTop: '16px', display: 'flex', justifyContent: 'center', gap: '12px', flexWrap: 'wrap' }}>
          {[
            { type: 'action', label: 'User Action' },
            { type: 'request', label: 'HTTP Request' },
            { type: 'response', label: 'Response' },
            { type: 'query', label: 'DB Query' },
            { type: 'internal', label: 'Internal' },
            { type: 'success', label: 'Success' },
            { type: 'error', label: 'Error' }
          ].map((item) => (
            <div key={item.type} style={{ display: 'flex', alignItems: 'center', gap: '4px' }}>
              <div style={{ width: '12px', height: '12px', borderRadius: '50%', background: getStepColor(item.type) }} />
              <span style={{ color: '#64748B', fontSize: '9px' }}>{item.label}</span>
            </div>
          ))}
        </div>
      </div>
    </div>
  );
};

    ReactDOM.createRoot(document.getElementById("root")).render(<Component />);
  </script>
</body>
</html>
